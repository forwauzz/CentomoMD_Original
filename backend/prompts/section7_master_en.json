{
  "metadata": {
    "section": "7",
    "name": "History of Facts and Evolution",
    "locale": "en-CA",
    "version": "1.0.0",
    "description": "Guardrail JSON to structure and validate Section 7 (CNESST). Ensures standardized terminology, headings, dates, and enforces worker-first narrative."
  },

  "structure": {
    "entry_contract": "Each entry must describe a distinct event/consultation/procedure.",
    "required_headings": [],
    "order_rules": {
      "chronological": true,
      "ascending": true,
      "allow_same_day_multiple": true
    },
    "entry_template_hint": "The worker [verb] Dr. [Name], on [date]. [content]"
  },

  "style_rules": {
    "worker_first": true,
    "forbid_date_first": true,
    "doctor_title_required": true,
    "quotes_keep_exact": true,
    "no_patient_term": true,
    "paragraph_per_event": true,
    "vary_verbs": true,
    "avoid_mechanical_repetition": true,
    "language": "en-CA"
  },

  "terminology": {
    "preferred": {
      "patient": "the worker",
      "male patient": "the worker",
      "female patient": "the worker",
      "doctor.": "doctor",
      "Doctor": "doctor",
      "physician": "treating physician"
    },
    "prohibited": [
      "the patient",
      "patient",
      "On [0-9]{1,2}\\s*[A-Za-z]+\\s*[0-9]{4},?\\s*the worker",
      "The\\s*[0-9]{1,2}\\s*[A-Za-z]+\\s*[0-9]{4}"
    ],
    "verbs_consultation": [
      "consults",
      "meets",
      "revisits",
      "obtains an appointment with",
      "presents to"
    ],
    "specialties": [
      "orthopedic surgeon",
      "physiatrist",
      "radiologist",
      "neurosurgeon",
      "family physician",
      "emergency physician",
      "general practitioner"
    ],
    "lesions": [
      "cervical sprain",
      "lumbar sprain",
      "contusion",
      "tendonitis",
      "tenosynovitis",
      "meniscal tear",
      "rotator cuff tear",
      "capsulitis",
      "radiculopathy",
      "cervicobrachialgia",
      "synovitis",
      "gonarthrosis"
    ],
    "exams": [
      "MRI",
      "ultrasound",
      "X-ray",
      "arthro-MRI",
      "EMG",
      "CT scan"
    ],
    "treatments": [
      "physiotherapy",
      "occupational therapy",
      "acupuncture",
      "cortisone injection",
      "viscosupplementation",
      "orthosis",
      "surgery",
      "antibiotic therapy"
    ],
    "evolution_keywords": [
      "improved",
      "stable",
      "worsened",
      "therapeutic plateau",
      "consolidation with sequelae",
      "permanent sequelae"
    ]
  },

  "dates": {
    "allowed_formats": [
      "MMMM d yyyy",
      "MMM d yyyy",
      "MMMM dd yyyy"
    ],
    "normalize_month_names": true,
    "examples": [
      "October 23 2022",
      "August 1 2024"
    ]
  },

  "patterns": {
    "entry_regex": "^\\s*(The worker)\\s+(consults|meets|revisits|obtains an appointment with|presents to)\\s+(Dr\\.|Doctor)\\s+[^,]+,\\s+on\\s+[0-9]{1,2}(st|nd|rd|th)?\\s+[A-Za-z]+\\s+[0-9]{4}\\.?\\s",
    "forbid_date_first_regex": "^\\s*On\\s+[0-9]{1,2}",
    "doctor_title_regex": "\\b(Dr\\.|Doctor)\\b",
    "quote_block_regex": "“[\\s\\S]*?”",
    "evolution_presence_regex": "\\b(improved|stable|worsened|plateau|consolidation|sequelae)\\b"
  },

  "normalization": {
    "case_fixes": [
      { "find": "\\bDoctor\\b", "replace": "doctor" }
    ],
    "term_replacements_ci": [
      { "find": "\\bthe patient\\b", "replace": "the worker" },
      { "find": "\\bpatient\\b", "replace": "the worker" }
    ],
    "titles": {
      "always_require_title": true,
      "preferred_titles": ["Dr.", "Doctor"]
    },
    "spacing": {
      "after_comma": true,
      "single_spaces": true
    }
  },

  "qa_checks": {
    "require_worker_first": true,
    "forbid_starting_with_date": true,
    "require_doctor_title_each_entry": true,
    "require_date_each_entry": true,
    "require_paragraph_per_event": true,
    "require_variation_of_verbs": {
      "min_distinct_verbs": 2
    },
    "require_evolution_mentions": {
      "at_least_once": true
    },
    "chronology": {
      "enforce": true,
      "direction": "ascending"
    },
    "duplicate_sentence_guard": {
      "enable": true,
      "min_distance_chars": 50
    },
    "quote_integrity": {
      "preserve_exact_quotes": true
    }
  },

  "few_shot": [
    {
      "input_note": "first consultation, dr smith, October 23 2022, cervical sprain, prescribes physio",
      "output_snippet": "The worker consults Dr. John Smith, on October 23 2022. He diagnoses a cervical sprain and prescribes physiotherapy."
    },
    {
      "input_note": "follow-up dr lee August 1 2024, lumbar contusion stable, gradual return",
      "output_snippet": "The worker revisits Dr. Mark Lee, on August 1 2024. He judges the condition stable and prescribes a gradual return to work."
    }
  ],

  "injection_policy": {
    "always_inject_sections": ["style_rules", "terminology.verbs_consultation", "few_shot"],
    "conditionally_inject_long_example": true,
    "long_example_label": "FULL EXAMPLE (reference for form, do not copy verbatim)"
  }
}