# Section 7 AI Formatter - Prompt File Injection Flow

## ğŸ¯ **Complete Flow Diagram**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           SECTION 7 AI FORMATTER TEMPLATE                      â”‚
â”‚                              Prompt Injection Flow                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   USER INPUT    â”‚    â”‚  LANGUAGE       â”‚    â”‚  TEMPLATE       â”‚
â”‚                 â”‚    â”‚  DETECTION      â”‚    â”‚  SELECTION      â”‚
â”‚ Raw Medical     â”‚â”€â”€â”€â–¶â”‚                 â”‚â”€â”€â”€â–¶â”‚                 â”‚
â”‚ Transcript      â”‚    â”‚ fr | en         â”‚    â”‚ section7-ai-    â”‚
â”‚                 â”‚    â”‚                 â”‚    â”‚ formatter       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                         â”‚
                                                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        STEP 1: LOAD LANGUAGE-SPECIFIC FILES                    â”‚
â”‚                              loadLanguageSpecificFiles()                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   FRENCH PATH   â”‚    â”‚  ENGLISH PATH   â”‚    â”‚   FILE LOADING  â”‚
â”‚                 â”‚    â”‚                 â”‚    â”‚                 â”‚
â”‚ section7_       â”‚    â”‚ section7_       â”‚    â”‚ readFileSync()  â”‚
â”‚ master.md       â”‚    â”‚ master_en.md    â”‚    â”‚ JSON.parse()    â”‚
â”‚                 â”‚    â”‚                 â”‚    â”‚                 â”‚
â”‚ section7_       â”‚    â”‚ section7_       â”‚    â”‚ UTF-8 encoding  â”‚
â”‚ master.json     â”‚    â”‚ master_en.json  â”‚    â”‚                 â”‚
â”‚                 â”‚    â”‚                 â”‚    â”‚                 â”‚
â”‚ section7_       â”‚    â”‚ section7_       â”‚    â”‚ Error handling  â”‚
â”‚ golden_example  â”‚    â”‚ golden_example  â”‚    â”‚                 â”‚
â”‚ .md             â”‚    â”‚ _en.md          â”‚    â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                       â”‚                       â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        STEP 2: CONSTRUCT SYSTEM PROMPT                         â”‚
â”‚                            constructSystemPrompt()                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   MASTER PROMPT â”‚    â”‚  GOLDEN EXAMPLE â”‚    â”‚  JSON CONFIG    â”‚
â”‚                 â”‚    â”‚                 â”‚    â”‚                 â”‚
â”‚ Base formatting â”‚    â”‚ Reference       â”‚    â”‚ Style rules     â”‚
â”‚ instructions    â”‚    â”‚ structure       â”‚    â”‚ Terminology     â”‚
â”‚                 â”‚    â”‚                 â”‚    â”‚ QA checks       â”‚
â”‚ Worker-first    â”‚    â”‚ CNESST format   â”‚    â”‚ Few-shot        â”‚
â”‚ rule            â”‚    â”‚                 â”‚    â”‚ examples        â”‚
â”‚                 â”‚    â”‚ Chronological   â”‚    â”‚                 â”‚
â”‚ Medical terms   â”‚    â”‚ order           â”‚    â”‚ Validation      â”‚
â”‚                 â”‚    â”‚                 â”‚    â”‚ rules           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                       â”‚                       â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        STEP 3: INJECT JSON CONFIGURATION                       â”‚
â”‚                          injectJSONConfiguration()                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STYLE RULES    â”‚    â”‚ TERMINOLOGY     â”‚    â”‚  QA CHECKS      â”‚
â”‚                 â”‚    â”‚                 â”‚    â”‚                 â”‚
â”‚ â€¢ worker_first  â”‚    â”‚ â€¢ preferred     â”‚    â”‚ â€¢ chronology    â”‚
â”‚ â€¢ chronological â”‚    â”‚   terms         â”‚    â”‚ â€¢ validation    â”‚
â”‚ â€¢ doctor_title  â”‚    â”‚ â€¢ prohibited    â”‚    â”‚ â€¢ duplicates    â”‚
â”‚ â€¢ quotes_keep   â”‚    â”‚   terms         â”‚    â”‚ â€¢ integrity     â”‚
â”‚                 â”‚    â”‚ â€¢ verbs         â”‚    â”‚                 â”‚
â”‚ â€¢ paragraph_    â”‚    â”‚ â€¢ specialties   â”‚    â”‚ â€¢ evolution     â”‚
â”‚   per_event     â”‚    â”‚ â€¢ lesions       â”‚    â”‚   mentions      â”‚
â”‚                 â”‚    â”‚ â€¢ exams         â”‚    â”‚                 â”‚
â”‚ â€¢ vary_verbs    â”‚    â”‚ â€¢ treatments    â”‚    â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                       â”‚                       â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        STEP 4: FINAL SYSTEM PROMPT ASSEMBLY                    â”‚
â”‚                              Complete Prompt Structure                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  COMPREHENSIVE SYSTEM PROMPT                                                   â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                                 â”‚
â”‚  1. MASTER PROMPT (Base Instructions)                                          â”‚
â”‚     â”œâ”€â”€ Worker-first rule enforcement                                          â”‚
â”‚     â”œâ”€â”€ Chronological ordering                                                 â”‚
â”‚     â”œâ”€â”€ Medical terminology preservation                                       â”‚
â”‚     â”œâ”€â”€ CNESST formatting standards                                            â”‚
â”‚     â””â”€â”€ Language-specific instructions                                         â”‚
â”‚                                                                                 â”‚
â”‚  2. REFERENCE EXAMPLE (Golden Standard)                                        â”‚
â”‚     â”œâ”€â”€ Complete CNESST Section 7 example                                      â”‚
â”‚     â”œâ”€â”€ Proper structure demonstration                                         â”‚
â”‚     â”œâ”€â”€ Medical terminology usage                                              â”‚
â”‚     â””â”€â”€ Chronological flow example                                             â”‚
â”‚                                                                                 â”‚
â”‚  3. STYLE RULES (Critical Requirements)                                        â”‚
â”‚     â”œâ”€â”€ Worker-first: REQUIRED                                                 â”‚
â”‚     â”œâ”€â”€ Chronological: REQUIRED                                                â”‚
â”‚     â”œâ”€â”€ Doctor title: REQUIRED                                                 â”‚
â”‚     â””â”€â”€ Paragraph per event: REQUIRED                                          â”‚
â”‚                                                                                 â”‚
â”‚  4. TERMINOLOGY RULES                                                          â”‚
â”‚     â”œâ”€â”€ Replace "patient" with "worker"                                        â”‚
â”‚     â”œâ”€â”€ NEVER use prohibited terms                                             â”‚
â”‚     â”œâ”€â”€ Use approved medical terminology                                       â”‚
â”‚     â””â”€â”€ Preserve specialized CNESST terms                                      â”‚
â”‚                                                                                 â”‚
â”‚  5. QA VERIFICATION RULES                                                      â”‚
â”‚     â”œâ”€â”€ Chronology enforcement                                                 â”‚
â”‚     â”œâ”€â”€ Duplicate sentence guard                                               â”‚
â”‚     â”œâ”€â”€ Quote integrity preservation                                           â”‚
â”‚     â””â”€â”€ Evolution mentions required                                            â”‚
â”‚                                                                                 â”‚
â”‚  6. FEW-SHOT EXAMPLES                                                          â”‚
â”‚     â”œâ”€â”€ Input/Output pairs                                                     â”‚
â”‚     â”œâ”€â”€ Consultation formatting                                                â”‚
â”‚     â”œâ”€â”€ Date formatting                                                        â”‚
â”‚     â””â”€â”€ Medical terminology usage                                              â”‚
â”‚                                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        STEP 5: OPENAI API CALL                                 â”‚
â”‚                              callOpenAI()                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SYSTEM MESSAGE â”‚    â”‚  USER MESSAGE   â”‚    â”‚  API RESPONSE   â”‚
â”‚                 â”‚    â”‚                 â”‚    â”‚                 â”‚
â”‚ Complete        â”‚    â”‚ "Format this    â”‚    â”‚ Formatted       â”‚
â”‚ system prompt   â”‚    â”‚ raw medical     â”‚    â”‚ Section 7       â”‚
â”‚ with all        â”‚    â”‚ text according  â”‚    â”‚ content         â”‚
â”‚ components      â”‚    â”‚ to CNESST       â”‚    â”‚                 â”‚
â”‚                 â”‚    â”‚ standards"      â”‚    â”‚ Worker-first    â”‚
â”‚ Temperature:    â”‚    â”‚                 â”‚    â”‚ structure       â”‚
â”‚ 0.2 (low)       â”‚    â”‚ + Raw transcriptâ”‚    â”‚                 â”‚
â”‚                 â”‚    â”‚                 â”‚    â”‚ Chronological   â”‚
â”‚ Max tokens:     â”‚    â”‚                 â”‚    â”‚ order           â”‚
â”‚ 4000            â”‚    â”‚                 â”‚    â”‚                 â”‚
â”‚                 â”‚    â”‚                 â”‚    â”‚ Medical terms   â”‚
â”‚ Model:          â”‚    â”‚                 â”‚    â”‚ preserved       â”‚
â”‚ gpt-4o-mini     â”‚    â”‚                 â”‚    â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        STEP 6: POST-PROCESSING                                 â”‚
â”‚                              Clean & Validate                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CLEAN OUTPUT   â”‚    â”‚  VALIDATION     â”‚    â”‚  FINAL RESULT   â”‚
â”‚                 â”‚    â”‚                 â”‚    â”‚                 â”‚
â”‚ Remove markdown â”‚    â”‚ Check worker-   â”‚    â”‚ Formatted       â”‚
â”‚ headers         â”‚    â”‚ first rule      â”‚    â”‚ Section 7       â”‚
â”‚                 â”‚    â”‚                 â”‚    â”‚ content         â”‚
â”‚ Trim whitespace â”‚    â”‚ Verify          â”‚    â”‚                 â”‚
â”‚                 â”‚    â”‚ chronological   â”‚    â”‚ Ready for       â”‚
â”‚ Normalize       â”‚    â”‚ order           â”‚    â”‚ CNESST          â”‚
â”‚ formatting      â”‚    â”‚                 â”‚    â”‚ submission      â”‚
â”‚                 â”‚    â”‚ Validate        â”‚    â”‚                 â”‚
â”‚ Error handling  â”‚    â”‚ medical terms   â”‚    â”‚ Success!        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”„ **File Injection Sequence**

### **Language Detection â†’ File Selection**
```
Language: 'fr' (French)
â”œâ”€â”€ section7_master.md          (Base instructions)
â”œâ”€â”€ section7_master.json        (Configuration rules)
â””â”€â”€ section7_golden_example.md  (Reference example)

Language: 'en' (English)  
â”œâ”€â”€ section7_master_en.md       (Base instructions)
â”œâ”€â”€ section7_master_en.json     (Configuration rules)
â””â”€â”€ section7_golden_example_en.md (Reference example)
```

### **System Prompt Assembly Order**
1. **Master Prompt** (Base foundation)
2. **Golden Example** (Reference structure)
3. **JSON Configuration** (Rules & validation)
   - Style rules
   - Terminology rules
   - QA verification rules
   - Few-shot examples

## ğŸ¯ **Key Features of This Flow**

- **Language-Aware**: Automatically selects correct files based on language
- **Modular**: Each file has a specific purpose and can be updated independently
- **Comprehensive**: Combines instructions, examples, and validation rules
- **Robust**: Includes error handling and fallback mechanisms
- **CNESST-Compliant**: Enforces Quebec medical reporting standards

## ğŸ“‹ **File Purposes**

| File | Purpose | Content |
|------|---------|---------|
| `section7_master.md/en.md` | Base instructions | Worker-first rule, chronological order, medical terminology |
| `section7_master.json/en.json` | Configuration rules | Style rules, terminology, QA checks, few-shot examples |
| `section7_golden_example.md/en.md` | Reference example | Complete CNESST Section 7 example for structure reference |

This flow ensures that the Section 7 AI Formatter has access to all necessary instructions, examples, and validation rules to produce properly formatted CNESST-compliant medical reports.
